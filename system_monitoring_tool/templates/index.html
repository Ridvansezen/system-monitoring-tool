<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitoring</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <!-- Include your JavaScript file -->
    <script src="{% static 'js/chart.js' %}"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>System Monitoring Data</h1>
        <table class="monitoring-table">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>RAM Usage (%)</th>
                    <th>CPU Usage (%)</th>
                    <th>HDD Usage (%)</th>
                    <th>Network Requests</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in data %}
                    <tr>
                        <td>{{ formatted_timestamp|default:"No date" }}</td>
                        <td>{{ entry.ram_usage }}</td>
                        <td>{{ entry.cpu_usage }}</td>
                        <td>{{ entry.hdd_usage }}</td>
                        <td>{{ entry.network_requests }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        
        <!--Chart-->

        <div id="systemChartContainer">
            <canvas id="systemChart"></canvas>
        </div>

        <div id="timestamps" style="display: none;">[{% for entry in data %}"{{ entry.timestamp|date:'Y-m-d H:i:s' }}"{% if not forloop.last %},{% endif %}{% endfor %}]</div>
        <div id="cpuUsage" style="display: none;">[{% for entry in data %}{{ entry.cpu_usage }}{% if not forloop.last %},{% endif %}{% endfor %}]</div>
        <div id="ramUsage" style="display: none;">[{% for entry in data %}{{ entry.ram_usage }}{% if not forloop.last %},{% endif %}{% endfor %}]</div>
        <div id="hddUsage" style="display: none;">[{% for entry in data %}{{ entry.hdd_usage }}{% if not forloop.last %},{% endif %}{% endfor %}]</div>

        <script type="text/javascript">
            var timestamps = JSON.parse(document.getElementById('timestamps').textContent);
            var cpuUsage = JSON.parse(document.getElementById('cpuUsage').textContent);
            var ramUsage = JSON.parse(document.getElementById('ramUsage').textContent);
            var hddUsage = JSON.parse(document.getElementById('hddUsage').textContent);

            // Grafik olu≈ütur
            var ctx = document.getElementById('systemChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamps,
                    datasets: [
                        {
                            label: 'CPU Usage (%)',
                            data: cpuUsage,
                            borderColor: 'rgb(255, 99, 132)',
                            borderWidth: 2,
                            fill: false,
                        },
                        {
                            label: 'RAM Usage (%)',
                            data: ramUsage,
                            borderColor: 'rgb(75, 192, 192)',
                            borderWidth: 2,
                            fill: false,
                        },
                        {
                            label: 'HDD Usage (%)',
                            data: hddUsage,
                            borderColor: 'rgb(54, 162, 235)',
                            borderWidth: 2,
                            fill: false,
                        },
                    ],
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                }
            });
        </script>
        
        
    </div>
</body>
</html>
